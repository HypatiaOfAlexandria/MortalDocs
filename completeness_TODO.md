# MortalMS Development: Necessary fixes & features for basic/expected functionality

## Key

Issue types:

| **Abbreviation** | **Meaning**                                  |
|------------------|----------------------------------------------|
| A                | Audio                                        |
| C                | Combat                                       |
| Ctl              | Player controls                              |
| F                | Fatal, i.e. causes a crash or forces restart |
| G                | Graphical                                    |
| GM               | Game-Mechanical                              |
| I                | User interface                               |
| M                | Meta                                         |
| N                | Networking                                   |
| O                | Outside of the main game                     |

## Issues

| **Priority** | **Difficulty** | **Type(s)** | **Issue**                                               | **Description**                                                                                                                                                                  |
|--------------|----------------|-------------|---------------------------------------------------------|----------------------------------------------------------------------------------------------------------------------------------------------------------------------------------|
| 10           | ?              | F, O        | Crash upon selecting character to play                  | Only (so far) reported to occur right after character creation.                                                                                                                  |
| 10           | ?              | F, O        | Mysterious crashing on Windows 10                       |                                                                                                                                                                                  |
| 25           | ?              | N           | Multi-player interaction mysteriously decoheres         | May have something to do with multiclienting(?)                                                                                                                                  |
| 50           | ?              | C           | Player death is nonfunctional                           |                                                                                                                                                                                  |
| 60           | ?              | C           | Tutorial mobs damage the player                         |                                                                                                                                                                                  |
| 70           | ?              | I           | NPC Yes/No dialog type is missing                       | Other types of dialog are probably missing as well.                                                                                                                              |
| 72           | ?              | I           | NPC dialogs are not centered and should be draggable    | NPC dialog position is based on the smaller, old resolution. Also should be draggable, with the position saved in settings.toml.                                                 |
| 75           | ?              | Ctl         | Dropping items drops one at a time, cannot drop stacks  |                                                                                                                                                                                  |
| 82           | ?              | Ctl         | Quickslots are not implemented                          |                                                                                                                                                                                  |
| 90           | ?              | N           | Unhandled packets                                       | Namely: opcodes 0x8A (138), 0xD6 (214), 0xDD (221), 0xDE (222), 0x8C (140), 0x150 (336), 0x151 (337), 0x132 (306).                                                               |
| 92           | ?              | Ctl         | Typing special characters is fucked up                  |                                                                                                                                                                                  |
| 95           | ?              | G, N        | ShowItemGainInChatHandler is not fully implemented      |                                                                                                                                                                                  |
| 97           | ?              | GM          | Reactor interactions are unimplemented                  |                                                                                                                                                                                  |
| 100          | ?              | I           | Cannot switch between chat targets                      | Thus, you can only use "To All".                                                                                                                                                 |
| 109          | ?              | G           | Text baseline doesn't quite line up on some UI elements | Probably just requires some compile-time constants to be tweaked; that being said, fooling around with picking a good "default font" is a good idea.                             |
| 112          | ?              | I           | Item icons in keybind UI don't show quantity            |                                                                                                                                                                                  |
| 112          | ?              | I           | Skill icons in keybind UI don't show tooltip            |                                                                                                                                                                                  |
| 115          | ?              | GM, C       | Mobs appear to not aggro                                |                                                                                                                                                                                  |
| 120          | ?              | I           | Minimap is not implemented                              |                                                                                                                                                                                  |
| 130          | ?              | Ctl         | Crappy rope/ladder controls                             | If you hold the up arrow key, and while still holding it, go within range of a rope/ladder, it will **not** put you on the rope/ladder.                                          |
| 130          | ?              | G           | Idle animation loops incorrectly                        | Should be frames 0, 1, 2, 1, 0, 1, 2, 1, etc., not 0, 1, 2, 0, 1, 2, etc.                                                                                                        |
| 136          | ?              | Ctl         | Pressing enter doesn't interact properly with chat      | The enter key should automatically focus the chat textbox, and pressing enter to send should both send and unfocus the textbox.                                                  |
| 136          | ?              | Ctl         | Continuing to hold down after downjumping does nothing  |                                                                                                                                                                                  |

## Closed issues

| **Type(s)** | **Issue**                                               | **Description**                                                                                                                                        | **Resolution**                                                                                                                                                                                                                                                    |
|-------------|---------------------------------------------------------|--------------------------------------------------------------------------------------------------------------------------------------------------------|-------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------|
| F, G        | Segmentation fault when decompressing bitmap            | Reported to occur once immediately upon pressing the 'd' key.                                                                                          | NLNX now uses `LZ4_decompress_safe` and properly handles both compressed and uncompressed bitmap sizes. It now returns `nullptr` on any kind of error occuring inside of `bitmap::data()`, making it much safer to use (so long as you check for null).           |
| F, I        | Null pointer dereference when opening skillbook         |                                                                                                                                                        | Set default value of `UISkillBook::tab` to `0` and specify exact layout of the `UISkillBook::Buttons` and `Job::Level` enums.                                                                                                                                     |
| G, I        | In-game screen resolution is too small                  | Set to 800x600, should be 1024x768                                                                                                                     | Window now resizes when entering the game, and the position of the main UI bar and scrolling server notices are adjusted.                                                                                                                                         |
| Ctl         | Keybindings are hard coded                              | Keybindings should be saved in a TOML file, and also editable from the in-game UI.                                                                     | Keybindings are now editable from the ordinary in-game menu and are saved on the server side using the appropriate packets. Still, the quickslot stuff is nonfunctional.                                                                                          |
| Ctl         | Only left-shift key works for capitalization            | Users should be able to use the right-shift and/or capslock keys as well.                                                                              | Left- and right- shift keys are now interchangeable, same goes for ctrl and alt.                                                                                                                                                                                  |
| G, O        | Main screen has no background                           |                                                                                                                                                        | Opening screen now has background and logo to match the channel select screen, although it is actually the incorrect one (v62). Additionally, character selection now has a background.                                                                           |
| O           | Main settings file should be TOML                       | Best to keep all settings in a unified, standard format.                                                                                               | Adopted cpptoml and revamped configuration interface.                                                                                                                                                                                                             |
| F, O, I     | Entering an invalid character name softlocks the player | Instead, this should just pop up an error message.                                                                                                     | Reordering the `UIType`s for character creation and login notice so that login notices pop up on top fixes the issue by allowing the "invalid name" notice to be seen and for the user to press "OK".                                                             |
| I           | In-game menus don't work                                | Includes main menu, settings menus, keybinding interface.                                                                                              | Added keybinding UI, channel change UI, in-game menu, game settings UI, and system settings UI.                                                                                                                                                                   |
| Ctl         | Textbox typing delay                                    | Makes it significantly more difficult to type into text boxes in the game, including for chatting or typing username/password, etc.                    | Turns out the problem was that unlike other key inputs (space, enter, etc.), letters and numbers were being typed in when the key was **released**, not when pushed.                                                                                              |
| F, O, I     | Need to select a slot to create a character             | If you try to create a character without first selecting a character slot, the UI (viz. the Ok/Cancel buttons) gets fucked up and you cannot continue. | I believe this was a result of some UB that was caused by reading from an uninitialized `bool`, which is now fixed.                                                                                                                                               |
| G           | Mysteriously disappearing hair                          |                                                                                                                                                        | I believe this was **also** the result of the above-mentioned UB.                                                                                                                                                                                                 |
| G, O        | Characters on selection screen are naked                | Only seems to occur directly after character creation.                                                                                                 | Probably also due to the above-mentioned UB?                                                                                                                                                                                                                      |
| Ctl         | Cannot bind skills/use items to keys                    |                                                                                                                                                        | Item icons are now bindable to keys, with an `action_id` equal to their item ID. Skill icons are now adapted to work as `Icon`s as well, with an `action_id` equal to the negation (2's complement) of their item ID.                                             |
| Ctl         | Double-clicking a use item doesn't activate it          |                                                                                                                                                        | Actually, double-clicking is replaced with right-clicking. Fairly convenient, really.                                                                                                                                                                             |
| GM          | You don't get skill points                              | Tested as a beginner                                                                                                                                   | Issue with HeavenMS not granting SP to beginners and/or an issue with the client not handling beginner skills correctly; it's more sane to gate 1st job advancement on condition of having spent all 6 beginner SP than to treat it differently than "normal" SP. |
| GM          | You start with no AP and 4 in all stats                 |                                                                                                                                                        | Simple server-side fix.                                                                                                                                                                                                                                           |
